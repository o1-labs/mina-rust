name: 'Setup Build Dependencies'
description: 'Install system dependencies required for building Mina'
inputs:
  include-sqlite:
    description: 'Include SQLite3 in the installation'
    required: false
    default: 'false'
  install-nextest:
    description: 'Install cargo-nextest for faster test execution'
    required: false
    default: 'false'
runs:
  using: 'composite'
  steps:
    - name: Setup build dependencies (Ubuntu)
      if: runner.os == 'Linux'
      shell: bash
      run: |
        sudo apt update || true
        if [ "${{ inputs.include-sqlite }}" = "true" ]; then
          sudo apt install -y protobuf-compiler sqlite3 || true
        else
          sudo apt install -y protobuf-compiler || true
        fi

    - name: Setup build dependencies (macOS)
      if: runner.os == 'macOS'
      shell: bash
      run: |
        brew install protobuf ocaml opam

    - name: Install cargo-nextest
      if: inputs.install-nextest == 'true'
      uses: taiki-e/install-action@v2
      with:
        tool: nextest